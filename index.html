<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Time Left Awake</title>

<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: transparent;
    margin: 0;
    padding: 16px;
    text-align: center;
  }

  .timer {
    font-size: 52px;
    font-weight: 600;
    margin-bottom: 12px;
  }

  .inputs {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 14px;
  }

  .inputs div {
    display: flex;
    flex-direction: column;
    font-size: 11px;
    opacity: 0.7;
  }

  input[type="time"] {
    font-size: 14px;
    padding: 4px;
  }

  .bar-container {
    width: 100%;
    height: 8px;
    background: #e5e5e5;
    border-radius: 4px;
    overflow: hidden;
  }

  .bar {
    height: 100%;
    width: 0%;
    background: #4f46e5;
    transition: width 0.3s ease;
  }

  .percent {
    font-size: 11px;
    margin-top: 6px;
    opacity: 0.6;
  }
</style>
</head>

<body>

<div class="timer" id="countdown">--:--</div>

<div class="inputs">
  <div>
    <label>Wake</label>
    <input type="time" id="wakeTime" value="05:30">
  </div>
  <div>
    <label>Bed</label>
    <input type="time" id="bedTime" value="22:30">
  </div>
</div>

<div class="bar-container">
  <div class="bar" id="progressBar"></div>
</div>
<div class="percent" id="percentText">0%</div>

<script>
const countdown = document.getElementById("countdown");
const wakeInput = document.getElementById("wakeTime");
const bedInput = document.getElementById("bedTime");
const bar = document.getElementById("progressBar");
const percentText = document.getElementById("percentText");

function parseTime(baseDate, timeStr) {
  const [h, m] = timeStr.split(":").map(Number);
  const d = new Date(baseDate);
  d.setHours(h, m, 0, 0);
  return d;
}

function update() {
  const now = new Date();

  let wake = parseTime(now, wakeInput.value);
  let bed = parseTime(now, bedInput.value);

  // handle bedtime after midnight
  if (bed <= wake) {
    bed.setDate(bed.getDate() + 1);
  }

  // if current time is after midnight but before bed
  if (now < wake && bed.getDate() !== wake.getDate()) {
    wake.setDate(wake.getDate() - 1);
  }

  const totalMs = bed - wake;
  const remainingMs = Math.max(0, bed - now);
  const elapsedMs = Math.min(totalMs, Math.max(0, now - wake));

  // countdown display
  if (now < wake) {
    const msUntilWake = wake - now;
    const mins = Math.floor(msUntilWake / 60000);
    countdown.textContent = `${String(Math.floor(mins / 60)).padStart(2,"0")}:${String(mins % 60).padStart(2,"0")}`;
  } else if (now >= bed) {
    countdown.textContent = "00:00";
  } else {
    const mins = Math.floor(remainingMs / 60000);
    countdown.textContent = `${String(Math.floor(mins / 60)).padStart(2,"0")}:${String(mins % 60).padStart(2,"0")}`;
  }

  // progress bar
  const percent = Math.max(0, Math.min(100, Math.round((elapsedMs / totalMs) * 100)));
  bar.style.width = percent + "%";
  percentText.textContent = percent + "% awake used";
}

update();
setInterval(update, 60000);
wakeInput.addEventListener("change", update);
bedInput.addEventListener("change", update);
</script>

</body>
</html>
