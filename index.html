<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
body {
  margin: 0;
  background: #f2f2f2;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  text-align: center;
  color: #111;
}

#container {
  display: none;
}

#label {
  font-size: 12px;
  opacity: 0.6;
  margin-bottom: 10px;
  letter-spacing: 1px;
  text-transform: uppercase;
}

#timer {
  font-size: 72px;
  font-weight: 600;
  letter-spacing: 2px;
  margin-bottom: 20px;
}

#progressContainer {
  width: 260px;
  height: 4px;
  background: #dddddd;
  border-radius: 4px;
  overflow: hidden;
  margin: 0 auto;
}

#progressBar {
  height: 100%;
  width: 0%;
  background: #222;
  transition: width 0.5s ease;
}
</style>
</head>
<body>

<div id="container">
  <div id="label"></div>
  <div id="timer">--:--</div>
  <div id="progressContainer">
    <div id="progressBar"></div>
  </div>
</div>

<script>
const API_KEY = "AIzaSyBulpufS7w0xT0QjHIlg75Em8TXRAJfNaA";
const CALENDAR_IDS = [
  "f98a845d2d487246693d4bc740c763e8869338b01cf0ee3711c21436200e344d@group.calendar.google.com"
];

let wakeTime = null;
let bedTime = null;

async function fetchWakeBed() {
  const now = new Date();
  const timeMin = new Date(now.getTime() - 24*60*60*1000).toISOString();
  const timeMax = new Date(now.getTime() + 48*60*60*1000).toISOString();

  let events = [];

  for (const id of CALENDAR_IDS) {
    const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(id)}/events?key=${API_KEY}&timeMin=${timeMin}&timeMax=${timeMax}&singleEvents=true&orderBy=startTime`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      if (data.items) events = events.concat(data.items);
    } catch (err) {
      console.log("Calendar fetch error:", err);
    }
  }

  const nowTime = new Date();

  const wakeEvent = events.find(e =>
    e.summary && e.summary.toLowerCase() === "wake" &&
    new Date(e.start.dateTime) <= nowTime
  );

  const bedEvent = events.find(e =>
    e.summary && e.summary.toLowerCase() === "bed" &&
    new Date(e.start.dateTime) <= nowTime
  );

  if (wakeEvent && bedEvent) {
    wakeTime = new Date(wakeEvent.start.dateTime);
    bedTime = new Date(bedEvent.end.dateTime);

    // If bed occurs before wake (overnight)
    if (bedTime <= wakeTime) {
      bedTime.
